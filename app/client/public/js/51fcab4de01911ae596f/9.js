webpackJsonp([9],{1291:function(e,t,n){"use strict";function r(e,t){if(s)return localStorage.setItem(e,t)}function o(e){if(s)return localStorage.getItem(e)}function i(e){if(s)return localStorage.removeItem(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.setItem=r,t.getItem=o,t.removeItem=i;var s=!1;try{s="localStorage"in window;var a="tusSupport";localStorage.setItem(a,localStorage.getItem(a))}catch(e){if(e.code!==e.SECURITY_ERR&&e.code!==e.QUOTA_EXCEEDED_ERR)throw e;s=!1}t.canStoreURLs=s},1297:function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=n(73),a=n.n(s),l=n(0),u=n.n(l),c=n(51),p=n(185),f=(n.n(p),n(117)),h=n(72),d=n(71),y=(n.n(d),n(569)),v=n(1310),m=n.n(v);n.d(t,"default",function(){return P});var g,_,b,E,w=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},S=function(e){return{auth:e.auth,error:e.listings.error}},C=function(e){return{dispatch:e,actions:{alert:n.i(f.a)(h.b,e),listings:n.i(f.a)(h.c,e),uploads:n.i(f.a)(h.d,e)}}},P=(g=n.i(c.connect)(S,C))((E=b=function(e){function t(n){r(this,t);var i=o(this,e.call(this,n));return i.state={isLoading:!0,photos:[],listing:{amenities:[],city:"",description:"",state:"",type:""}},i.handleChange=i.handleChange.bind(i),i.handleContinue=i.handleContinue.bind(i),i.handleStateChange=i.handleStateChange.bind(i),i.handleAmenityChange=i.handleAmenityChange.bind(i),i.handleTypeChange=i.handleTypeChange.bind(i),i.handleSave=i.handleSave.bind(i),i.handleSelectPhotos=i.handleSelectPhotos.bind(i),i}return i(t,e),t.prototype.componentWillMount=function(){if(!this.props.auth.user)return this.props.dispatch(n.i(p.push)("/submit"));this.setState({isLoading:!1}),this.props.setActiveStep("listing"),this.props.setCompletedSteps()},t.prototype.componentWillUnmount=function(){this.props.setActiveStep(!1)},t.prototype.componentDidMount=function(){this.handleSelectPhotosChanges(),y.a.done()},t.prototype.hasValidationError=function(e){return!(!a()(this.props.error,"validation.keys")||!this.props.error.validation.keys.includes(e))},t.prototype.handleContinue=function(e){var t=this;e.preventDefault(),this.setState({isLoading:!0},function(){var n=t.state.listing;t.props.actions.listings.create(w({},n)).then(function(n){t.setState({listing:w({},n.payload.listing)}),t.handleSave(e)}).catch(function(e){t.setState({isLoading:!1}),t.props.actions.alert.error(e.message)})})},t.prototype.handleChange=function(e){var t=this.state.listing;t[e.target.name]=e.target.value,this.setState({listing:t})},t.prototype.handleStateChange=function(e,t){this.setState({listing:w({},this.state.listing,{state:t.value})})},t.prototype.handleAmenityChange=function(e,t){this.setState({listing:w({},this.state.listing,{amenities:t.value})})},t.prototype.handleTypeChange=function(e,t){this.setState({listing:w({},this.state.listing,{type:t.value})})},t.prototype.componentDidMount=function(){this.handleSelectPhotosChanges()},t.prototype.handleUpload=function(e){for(var t=this,n=this.fileInput.files,r=function(){if(i){if(s>=o.length)return"break";a=o[s++]}else{if(s=o.next(),s.done)return"break";a=s.value}var e=a,n=new m.a.Upload(e,{endpoint:"/api/uploads",headers:{},onError:function(e){t.setState({isLoading:!1},function(){return t.props.actions.alert.error(e)}),y.a.done()},onProgress:function(e,t){var n=(e/t*100).toFixed(2);y.a.set(n/100)},onSuccess:function(){var e=new RegExp(".*/uploads/(.*)$").exec(n.url)[1];t.props.actions.uploads.update({id:e,listingId:t.state.listing.id}).then(function(e){t.props.actions.alert.success(e.payload.upload.name+" created!")}).catch(function(e){return t.props.actions.alert.error(e.message)})}});n.start()},o=n,i=Array.isArray(o),s=0,o=i?o:o[Symbol.iterator]();;){var a;if("break"===r())break}},t.prototype.handleSelectPhotos=function(e){e.preventDefault(),this.fileInput.click()},t.prototype.handleSelectPhotosChanges=function(){var e=this;this.fileInput.addEventListener("change",function(t){var n=t.target.files;e.setState({photos:n})})},t.prototype.handleSave=function(e){var t=this;e.preventDefault(),e.persist(),this.setState({isLoading:!0},function(){return t.handleUpload(e)})},t.prototype.render=function(){var e=this,t=[{key:"fl",value:"Florida",text:"Florida"}],n=[{key:"cable",value:"cable",text:"Cable"},{key:"electricity",value:"electricity",text:"Electricity"},{key:"internet",value:"internet",text:"Internet"},{key:"water",value:"water",text:"Water"}],r=[{key:"marina",value:"marina",text:"Marina"},{key:"rack",value:"rack",text:"Rack"},{key:"trailer",value:"trailer",text:"Trailer"}];return u.a.createElement("div",null,u.a.createElement(d.Segment,{as:d.Form},u.a.createElement("input",{multiple:!0,type:"file",style:{display:"none"},ref:function(t){e.fileInput=t}}),u.a.createElement(d.Form.Group,null,u.a.createElement(d.Form.Field,{error:this.hasValidationError("type"),width:"4"},u.a.createElement("label",null,"Type"),u.a.createElement(d.Dropdown,{fluid:!0,search:!0,selection:!0,placeholder:"Type",options:r,name:"type",onChange:this.handleTypeChange,value:this.state.listing.type})),u.a.createElement(d.Form.Field,{error:this.hasValidationError("city"),width:"7"},u.a.createElement("label",null,"City"),u.a.createElement(d.Input,{name:"city",onChange:this.handleChange,placeholder:"City",type:"text",value:this.state.listing.city})),u.a.createElement(d.Form.Field,{error:this.hasValidationError("state"),width:"5"},u.a.createElement("label",null,"State"),u.a.createElement(d.Dropdown,{fluid:!0,search:!0,selection:!0,placeholder:"State",options:t,name:"state",onChange:this.handleStateChange,value:this.state.listing.state}))),u.a.createElement(d.Form.Field,{error:this.hasValidationError("amenities")},u.a.createElement("label",null,"Amenities"),u.a.createElement(d.Dropdown,{fluid:!0,search:!0,selection:!0,multiple:!0,placeholder:"Amenities",options:n,name:"state",onChange:this.handleAmenityChange,value:this.state.listing.amenities})),u.a.createElement(d.Form.Field,{error:this.hasValidationError("description")},u.a.createElement("label",null,"Description"),u.a.createElement(d.TextArea,{name:"description",onChange:this.handleChange,placeholder:"Description",type:"text",value:this.state.listing.description})),u.a.createElement(d.Divider,{horizontal:!0},u.a.createElement(d.Icon,{circular:!0,name:"photo",color:"blue"})),u.a.createElement(d.Button,{fluid:!0,content:"Select Photos ("+this.state.photos.length+")",onClick:this.handleSelectPhotos})),u.a.createElement(d.Segment,null,u.a.createElement(d.Button,{fluid:!0,primary:!0,disabled:this.state.isLoading,loading:this.state.isLoading,onClick:this.handleContinue,icon:"right arrow",labelPosition:"right",content:"Continue"})))},t}(u.a.Component),b.propTypes={dispatch:l.PropTypes.func,error:l.PropTypes.object,actions:l.PropTypes.object.isRequired,auth:l.PropTypes.object.isRequired,setActiveStep:l.PropTypes.func.isRequired,setCompletedSteps:l.PropTypes.func.isRequired,steps:l.PropTypes.object.isRequired},_=E))||_},1298:function(e,t,n){"use strict";var r=Object.prototype.hasOwnProperty,o=Object.prototype.toString,i=function(e){return"function"==typeof Array.isArray?Array.isArray(e):"[object Array]"===o.call(e)},s=function(e){if(!e||"[object Object]"!==o.call(e))return!1;var t=r.call(e,"constructor"),n=e.constructor&&e.constructor.prototype&&r.call(e.constructor.prototype,"isPrototypeOf");if(e.constructor&&!t&&!n)return!1;var i;for(i in e);return void 0===i||r.call(e,i)};e.exports=function e(){var t,n,r,o,a,l,u=arguments[0],c=1,p=arguments.length,f=!1;for("boolean"==typeof u?(f=u,u=arguments[1]||{},c=2):("object"!=typeof u&&"function"!=typeof u||null==u)&&(u={});c<p;++c)if(null!=(t=arguments[c]))for(n in t)r=u[n],o=t[n],u!==o&&(f&&o&&(s(o)||(a=i(o)))?(a?(a=!1,l=r&&i(r)?r:[]):l=r&&s(r)?r:{},u[n]=e(f,l,o)):void 0!==o&&(u[n]=o));return u}},1304:function(e,t,n){var r,o;!function(i,s){r=s,void 0!==(o="function"==typeof r?r.call(t,n,t,e):r)&&(e.exports=o)}(0,function(){function e(){var e=arguments.length;if(0===e)throw new Error("resolveUrl requires at least one argument; got none.");var t=document.createElement("base");if(t.href=arguments[0],1===e)return t.href;var n=document.getElementsByTagName("head")[0];n.insertBefore(t,n.firstChild);for(var r,o=document.createElement("a"),i=1;i<e;i++)o.href=arguments[i],r=o.href,t.href=r;return n.removeChild(t),r}return e})},1305:function(e,t,n){"use strict";function r(e){return i(unescape(encodeURIComponent(e)))}Object.defineProperty(t,"__esModule",{value:!0}),t.encode=r;var o=window,i=o.btoa;t.isSupported="btoa"in window},1306:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(){return new window.XMLHttpRequest}function i(e,t){return(0,a.default)(e,t)}Object.defineProperty(t,"__esModule",{value:!0}),t.newRequest=o,t.resolveUrl=i;var s=n(1304),a=r(s)},1307:function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e){if("function"==typeof e.slice&&void 0!==e.size)return new s(e);throw new Error("source object may only be an instance of File or Blob in this environment")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0}),t.getSource=o;var s=function(){function e(t){r(this,e),this._file=t,this.size=t.size}return i(e,[{key:"slice",value:function(e,t){return this._file.slice(e,t)}},{key:"close",value:function(){}}]),e}()},1308:function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(e){var n=arguments.length<=1||void 0===arguments[1]?null:arguments[1],i=arguments.length<=2||void 0===arguments[2]?null:arguments[2];r(this,t);var s=o(this,Object.getPrototypeOf(t).call(this,e.message));s.originalRequest=i,s.causingError=n;var a=e.message;return null!=n&&(a+=", caused by "+n.toString()),null!=i&&(a+=", originated from request (response code: "+i.status+", response text: "+i.responseText+")"),s.message=a,s}return i(t,e),t}(Error);t.default=s},1309:function(e,t,n){"use strict";function r(e){return["tus",e.name,e.type,e.size,e.lastModified].join("-")}Object.defineProperty(t,"__esModule",{value:!0}),t.default=r},1310:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var o=n(1311),i=r(o),s=n(1291),a=i.default.defaultOptions;if("undefined"!=typeof window)var l=window,u=l.XMLHttpRequest,c=l.Blob,p=u&&c&&"function"==typeof c.prototype.slice;else var p=!0;e.exports={Upload:i.default,isSupported:p,canStoreURLs:s.canStoreURLs,defaultOptions:a}},1311:function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function o(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e){if(!m.isSupported)return"";var t=[];for(var n in e)t.push(n+" "+m.encode(e[n]));return t.join(",")}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var l=n(1309),u=o(l),c=n(1308),p=o(c),f=n(1298),h=o(f),d=n(1306),y=n(1307),v=n(1305),m=r(v),g=n(1291),_=r(g),b={endpoint:"",fingerprint:u.default,resume:!0,onProgress:null,onChunkComplete:null,onSuccess:null,onError:null,headers:{},chunkSize:1/0,withCredentials:!1,uploadUrl:null,uploadSize:null,overridePatchMethod:!1,retryDelays:null},E=function(){function e(t,n){i(this,e),this.options=(0,h.default)(!0,{},b,n),this.file=t,this.url=null,this._xhr=null,this._fingerprint=null,this._offset=null,this._aborted=!1,this._size=null,this._source=null,this._retryAttempt=0,this._retryTimeout=null,this._offsetBeforeRetry=0}return a(e,[{key:"start",value:function(){var e=this,t=this.file;if(!t)return void this._emitError(new Error("tus: no file or stream to upload provided"));if(!this.options.endpoint)return void this._emitError(new Error("tus: no endpoint provided"));var n=this._source=(0,y.getSource)(t,this.options.chunkSize);if(null!=this.options.uploadSize){var r=+this.options.uploadSize;if(isNaN(r))throw new Error("tus: cannot convert `uploadSize` option into a number");this._size=r}else{var r=n.size;if(null==r)throw new Error("tus: cannot automatically derive upload's size from input and must be specified manually using the `uploadSize` option");this._size=r}var o=this.options.retryDelays;if(null!=o){if("[object Array]"!==Object.prototype.toString.call(o))throw new Error("tus: the `retryDelays` option must either be an array or null");!function(){var t=e.options.onError;e.options.onError=function(n){e.options.onError=t,null!=e._offset&&e._offset>e._offsetBeforeRetry&&(e._retryAttempt=0);var r=!0;if("undefined"!=typeof window&&"navigator"in window&&!1===window.navigator.onLine&&(r=!1),!(e._retryAttempt<o.length&&null!=n.originalRequest&&r))return void e._emitError(n);var i=o[e._retryAttempt++];e._offsetBeforeRetry=e._offset,e.options.uploadUrl=e.url,e._retryTimeout=setTimeout(function(){e.start()},i)}}()}if(null!=this.options.uploadUrl)return this.url=this.options.uploadUrl,void this._resumeUpload();if(this.options.resume){this._fingerprint=this.options.fingerprint(t);var i=_.getItem(this._fingerprint);if(null!=i)return this.url=i,void this._resumeUpload()}this._createUpload()}},{key:"abort",value:function(){null!==this._xhr&&(this._xhr.abort(),this._source.close(),this._aborted=!0),null!=this._retryTimeout&&(clearTimeout(this._retryTimeout),this._retryTimeout=null)}},{key:"_emitXhrError",value:function(e,t,n){this._emitError(new p.default(t,n,e))}},{key:"_emitError",value:function(e){if("function"!=typeof this.options.onError)throw e;this.options.onError(e)}},{key:"_emitSuccess",value:function(){"function"==typeof this.options.onSuccess&&this.options.onSuccess()}},{key:"_emitProgress",value:function(e,t){"function"==typeof this.options.onProgress&&this.options.onProgress(e,t)}},{key:"_emitChunkComplete",value:function(e,t,n){"function"==typeof this.options.onChunkComplete&&this.options.onChunkComplete(e,t,n)}},{key:"_setupXHR",value:function(e){e.setRequestHeader("Tus-Resumable","1.0.0");var t=this.options.headers;for(var n in t)e.setRequestHeader(n,t[n]);e.withCredentials=this.options.withCredentials}},{key:"_createUpload",value:function(){var e=this,t=(0,d.newRequest)();t.open("POST",this.options.endpoint,!0),t.onload=function(){if(!(t.status>=200&&t.status<300))return void e._emitXhrError(t,new Error("tus: unexpected response while creating upload"));e.url=(0,d.resolveUrl)(e.options.endpoint,t.getResponseHeader("Location")),e.options.resume&&_.setItem(e._fingerprint,e.url),e._offset=0,e._startUpload()},t.onerror=function(n){e._emitXhrError(t,new Error("tus: failed to create upload"),n)},this._setupXHR(t),t.setRequestHeader("Upload-Length",this._size);var n=s(this.options.metadata);""!==n&&t.setRequestHeader("Upload-Metadata",n),t.send(null)}},{key:"_resumeUpload",value:function(){var e=this,t=(0,d.newRequest)();t.open("HEAD",this.url,!0),t.onload=function(){if(!(t.status>=200&&t.status<300))return e.options.resume&&_.removeItem(e._fingerprint),e.url=null,void e._createUpload();var n=parseInt(t.getResponseHeader("Upload-Offset"),10);if(isNaN(n))return void e._emitXhrError(t,new Error("tus: invalid or missing offset value"));var r=parseInt(t.getResponseHeader("Upload-Length"),10);return isNaN(r)?void e._emitXhrError(t,new Error("tus: invalid or missing length value")):n===r?(e._emitProgress(r,r),void e._emitSuccess()):(e._offset=n,void e._startUpload())},t.onerror=function(n){e._emitXhrError(t,new Error("tus: failed to resume upload"),n)},this._setupXHR(t),t.send(null)}},{key:"_startUpload",value:function(){var e=this,t=this._xhr=(0,d.newRequest)();this.options.overridePatchMethod?(t.open("POST",this.url,!0),t.setRequestHeader("X-HTTP-Method-Override","PATCH")):t.open("PATCH",this.url,!0),t.onload=function(){if(!(t.status>=200&&t.status<300))return void e._emitXhrError(t,new Error("tus: unexpected response while uploading chunk"));var n=parseInt(t.getResponseHeader("Upload-Offset"),10);return isNaN(n)?void e._emitXhrError(t,new Error("tus: invalid or missing offset value")):(e._emitProgress(n,e._size),e._emitChunkComplete(n-e._offset,n,e._size),e._offset=n,n==e._size?(e._emitSuccess(),void e._source.close()):void e._startUpload())},t.onerror=function(n){e._aborted||e._emitXhrError(t,new Error("tus: failed to upload chunk at offset "+e._offset),n)},"upload"in t&&(t.upload.onprogress=function(t){t.lengthComputable&&e._emitProgress(n+t.loaded,e._size)}),this._setupXHR(t),t.setRequestHeader("Upload-Offset",this._offset),t.setRequestHeader("Content-Type","application/offset+octet-stream");var n=this._offset,r=this._offset+this.options.chunkSize;(r===1/0||r>this._size)&&(r=this._size),t.send(this._source.slice(n,r))}}]),e}();E.defaultOptions=b,t.default=E}});